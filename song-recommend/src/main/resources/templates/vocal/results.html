<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
    <title>Results</title>
</head>
<body>
<h2>노래 추천 결과</h2>
<table style="width:100%">
    <tr>
        <th>No</th>
        <th>Title</th>
        <th>Artist</th>
        <th>Gender</th>
        <th>Lowest Note</th>
        <th>Highest Note</th>
    </tr>
</table>
<button th:onclick="|location.href = '/'|">Restart</button>

<script>
    window.onload = function() {
        let lowNote = sessionStorage.getItem('lowNote');
        let highNote = sessionStorage.getItem('highNote');

        console.log("작은값: " + lowNote);
        console.log("큰값: " + highNote);

        let data = {
            lowest_Note: lowNote,
            highest_Note: highNote
        };

        fetch('/getnote', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response 오류');
                }
                return response.json();
            })
            .then(data => {
                console.log('Received data:', data);
                let table = document.querySelector('table');

                data.forEach((song, index) => {
                    let row = table.insertRow();
                    let numberCell = row.insertCell(); // 번호를 표시할 셀
                    let titleCell = row.insertCell();
                    let artistCell = row.insertCell();
                    let genderCell = row.insertCell();
                    let lowestNoteCell = row.insertCell();
                    let highestNoteCell = row.insertCell();

                    numberCell.innerText = index + 1; // 인덱스는 0부터 시작하므로 1을 더함
                    titleCell.innerText = song.title;
                    artistCell.innerText = song.artist;
                    genderCell.innerText = song.gender;
                    lowestNoteCell.innerText = song.lowest_Note;
                    highestNoteCell.innerText = song.highest_Note;
                });
            })
            .catch(error => {
                console.error('오류남:', error);
            });
    };
</script>
</body>
</html>
